---
import ChevronLeft from "../../Icons/Ebook/ChevronLeft.astro";
import ChevronRight from "../../Icons/Ebook/ChevronRight.astro";

const pages = [
  {
    id: 1,
    image: "../iamges/imagen x derecha.svg",
    alt: "El 'Funnel' Anti-Curiosos - P치gina 12"
  },
  {
    id: 2,
    image: "../iamges/imagen x derecha.svg",
    alt: "Scripts de WhatsApp - P치gina 24"
  },
  {
    id: 3,
    image: "../iamges/imagen x derecha.svg",
    alt: "Anatom칤a del Anuncio - P치gina 08"
  },
  {
    id: 4,
    image: "../iamges/imagen 2.svg",
    alt: "Oferta Irresistible - P치gina 18"
  }
];
---

<section class="py-16 md:py-24 relative overflow-hidden">
  <div class="absolute inset-0 bg-[#0a0a0a] z-0"></div>
  <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] opacity-30 z-0"></div>

  <div class="max-w-6xl mx-auto px-4 relative z-10">
    
    <div class="text-center mb-12 md:mb-16">
      <h2 class="text-3xl md:text-5xl font-bold font-heading text-white mb-4 uppercase tracking-tight">
        Lo que encontrar치s <span class="text-transparent bg-clip-text bg-gradient-to-r from-[#D92027] to-pink-500">dentro</span> 游닀
      </h2>
      <p class="text-gray-400 text-sm md:text-base max-w-xl mx-auto">
        Sin relleno. Sin teor칤a aburrida. Solo t치cticas probadas para copiar y pegar en tu cl칤nica ma침ana mismo.
      </p>
    </div>

    <div class="relative flex items-center justify-center">
      
      <button 
        id="prev-slide"
        class="absolute -left-1 md:left-12 z-20 w-10 h-10 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-[#D92027] to-pink-600 flex items-center justify-center shadow-[0_0_20px_rgba(217,32,39,0.5)] hover:scale-110 active:scale-95 transition-all text-white border-2 border-white/20"
        aria-label="Previous slide"
      >
        <ChevronLeft />
      </button>

      <button 
        id="next-slide"
        class="absolute -right-1 md:right-12 z-20 w-10 h-10 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-[#D92027] to-pink-600 flex items-center justify-center shadow-[0_0_20px_rgba(217,32,39,0.5)] hover:scale-110 active:scale-95 transition-all text-white border-2 border-white/20"
        aria-label="Next slide"
      >
        <ChevronRight />
      </button>

      <div class="relative w-full max-w-[280px] md:max-w-4xl h-[400px] md:h-[450px] flex items-center justify-center perspective-1000" id="carousel-container">
         
         {pages.map((page, index) => {
           let positionClass = '';
           if (index === 0) {
             positionClass = 'z-20 scale-100 opacity-100 translate-x-0';
           } else if (index === 3) {
             positionClass = 'z-10 scale-[0.85] opacity-40 -translate-x-[60%] md:-translate-x-[350px] blur-[2px]';
           } else if (index === 1) {
             positionClass = 'z-10 scale-[0.85] opacity-40 translate-x-[60%] md:translate-x-[350px] blur-[2px]';
           } else {
             positionClass = 'hidden';
           }

           return (
             <picture
                class={`ebook-card absolute transition-all duration-500 ease-out w-[280px] md:w-[320px] aspect-[3/4] ${positionClass}`}
                data-index={index}
             >
                <img 
                  src={page.image} 
                  alt={page.alt} 
                  class="w-full h-full object-cover rounded-lg shadow-2xl"
                />
             </picture>
           );
         })}

      </div>
    </div>

    <div class="flex justify-center gap-2 mt-8 md:mt-12" id="indicators">
       {pages.map((_, idx) => (
          <button 
            class={`ebook-indicator transition-all duration-300 rounded-full h-2 ${idx === 0 ? 'w-8 bg-brand-red' : 'w-2 bg-gray-700 hover:bg-gray-500'}`}
            data-index={idx}
          />
       ))}
    </div>

  </div>
</section>

<script>
  let currentIndex = 0;
  const totalPages = 4;

  function updateCarousel() {
    const cards = document.querySelectorAll('.ebook-card');
    const indicators = document.querySelectorAll('.ebook-indicator');

    cards.forEach((card, index) => {
      card.classList.remove(
        'z-20', 'scale-100', 'opacity-100', 'translate-x-0',
        'z-10', 'scale-[0.85]', 'opacity-40', 
        '-translate-x-[60%]', 'md:-translate-x-[350px]', 
        'translate-x-[60%]', 'md:translate-x-[350px]', 
        'blur-[2px]', 'hidden'
      );

      if (index === currentIndex) {
        card.classList.add('z-20', 'scale-100', 'opacity-100', 'translate-x-0');
      } else if (index === (currentIndex - 1 + totalPages) % totalPages) {
        card.classList.add('z-10', 'scale-[0.85]', 'opacity-40', '-translate-x-[60%]', 'md:-translate-x-[350px]', 'blur-[2px]');
      } else if (index === (currentIndex + 1) % totalPages) {
        card.classList.add('z-10', 'scale-[0.85]', 'opacity-40', 'translate-x-[60%]', 'md:translate-x-[350px]', 'blur-[2px]');
      } else {
        card.classList.add('hidden');
      }
    });

    indicators.forEach((indicator, index) => {
      if (index === currentIndex) {
        indicator.classList.remove('w-2', 'bg-gray-700');
        indicator.classList.add('w-8', 'bg-brand-red');
      } else {
        indicator.classList.remove('w-8', 'bg-brand-red');
        indicator.classList.add('w-2', 'bg-gray-700');
      }
    });
  }

  document.getElementById('prev-slide')?.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + totalPages) % totalPages;
    updateCarousel();
  });

  document.getElementById('next-slide')?.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % totalPages;
    updateCarousel();
  });

  document.querySelectorAll('.ebook-indicator').forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      currentIndex = index;
      updateCarousel();
    });
  });
</script>