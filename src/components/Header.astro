---
import ArrowDown from "../Icons/ArrowDown.astro";
import CardHeaderNav from "./Cards/CardHeaderNav.astro";
import ButtonWppHeader from "./Buttons/ButtonWppHeader.astro";
import ButtonWppHeaderDK from "./Buttons/ButtonWppHeader_DK.astro";
---

<!-- Header Fixed -->
<header 
    id="main-header"
    class="py-4 fixed top-0 left-0 w-full z-50 border-b border-white/5 transition-all duration-300"
>
    <div class="absolute inset-0 bg-[#0a0a0a]/90 backdrop-blur-2xl"></div>
    
    <nav class="relative max-w-7xl mx-auto px-5 flex items-center justify-between">
        
        <div class="relative z-[60] group">
            <a 
                href="/" 
                class="font-oswald text-2xl md:text-3xl font-bold hover:scale-105 transition-transform duration-300 inline-block relative"
            >
                <span class="absolute -inset-2 bg-primary/20 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 rounded-lg"></span>
                <span class="relative">
                    <span class="text-primary">Hack</span><span class="text-white">Dental</span>
                </span>
            </a>
        </div>

        <!-- Desktop Navigation -->
        <div class="hidden lg:flex items-center gap-10">
            <a 
                href="#educacion" 
                class="group relative text-gray-300 hover:text-white transition-all duration-300 flex items-center gap-2 px-4 py-2 rounded-lg hover:bg-white/5"
            >
                <span class="font-medium">Educación para Odontólogos</span>
                <span class="group-hover:translate-y-1 transition-transform duration-300 text-primary/60 group-hover:text-primary">
                    <ArrowDown />
                </span>
                <span class="absolute bottom-1 left-4 w-0 h-0.5 bg-gradient-to-r from-primary to-[#00ffc6] group-hover:w-[calc(100%-2rem)] transition-all duration-300"></span>
            </a>
            
            <a 
                href="#contacto" 
                class="group relative text-gray-300 hover:text-white transition-all duration-300 px-4 py-2 rounded-lg hover:bg-white/5 font-medium"
            >
                <span>Contacto</span>
                <span class="absolute bottom-1 left-4 w-0 h-0.5 bg-gradient-to-r from-primary to-[#00ffc6] group-hover:w-[calc(100%-2rem)] transition-all duration-300"></span>
            </a>
        </div>

        <!-- CTA Button Desktop -->
        <ButtonWppHeaderDK />

        <!-- Mobile Menu Button -->
        <button 
            id="mobile-menu-btn"
            class="lg:hidden relative z-[60] w-11 h-11 flex flex-col items-center justify-center gap-1.5 group rounded-lg hover:bg-white/5 transition-colors duration-300"
            aria-label="Abrir menú"
            aria-expanded="false"
        >
            <span class="hamburger-line w-6 h-0.5 bg-white transition-all duration-300 group-hover:bg-primary rounded-full"></span>
            <span class="hamburger-line w-6 h-0.5 bg-white transition-all duration-300 group-hover:bg-primary rounded-full"></span>
            <span class="hamburger-line w-6 h-0.5 bg-white transition-all duration-300 group-hover:bg-primary rounded-full"></span>
        </button>
    </nav>
</header>

<!-- Mobile Menu -->
<div 
    id="mobile-menu"
    class="lg:hidden fixed inset-0 translate-x-full transition-transform duration-500 ease-out z-[55] bg-black"
>
    <div class="absolute inset-0 bg-gradient-to-br from-[#0a0a0a] via-[#050505] to-[#0a0a0a]"></div>
    <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(circle at 2px 2px, white 1px, transparent 0); background-size: 40px 40px;"></div>
    <div class="absolute top-20 left-10 w-72 h-72 bg-primary/8 rounded-full blur-[120px] pointer-events-none"></div>
    <div class="absolute bottom-32 right-10 w-80 h-80 bg-[#00ffc6]/6 rounded-full blur-[140px] pointer-events-none"></div>
    
    <div class="relative h-full flex items-center justify-center overflow-y-auto px-6">
        
        <!-- Close Button -->
        <button
            id="mobile-menu-close"
            class="absolute top-6 right-6 z-10 w-12 h-12 flex items-center justify-center rounded-xl bg-white/5 hover:bg-white/10 border border-white/10 hover:border-primary/50 transition-all duration-300 group backdrop-blur-xl"
            aria-label="Cerrar menú"
        >
            <svg class="w-6 h-6 text-gray-400 group-hover:text-primary group-hover:rotate-90 transition-all duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
            </svg>
        </button>

        <nav class="w-full flex flex-col gap-6 pb-24 pt-48">
            <CardHeaderNav />
            <div class="flex flex-col gap-3">
                <a 
                    href="#educacion" 
                    class="mobile-link opacity-0 translate-y-8 group relative"
                    style="transition-delay: 100ms;"
                >
                    <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-white/[0.07] to-white/[0.02] border border-white/10 backdrop-blur-xl p-6 group-hover:border-primary/30 transition-all duration-500 group-active:scale-[0.98]">
                        <div class="absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        
                        <div class="relative flex items-center justify-between">
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-white mb-1 group-hover:text-primary transition-colors duration-300">
                                    Educación para Odontólogos
                                </h3>
                                <p class="text-sm text-gray-500 group-hover:text-gray-400 transition-colors duration-300">
                                    Programas y recursos
                                </p>
                            </div>
                            
                            <div class="flex items-center justify-center w-10 h-10 rounded-xl bg-primary/10 group-hover:bg-primary/20 transition-all duration-300 group-hover:scale-110">
                                <svg class="w-5 h-5 text-primary group-hover:translate-x-0.5 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </a>
                
                <a 
                    href="#contacto" 
                    class="mobile-link opacity-0 translate-y-8 group relative"
                    style="transition-delay: 200ms;"
                >
                    <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-white/[0.07] to-white/[0.02] border border-white/10 backdrop-blur-xl p-6 group-hover:border-primary/30 transition-all duration-500 group-active:scale-[0.98]">
                        <div class="absolute inset-0 bg-gradient-to-br from-primary/5 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
                        
                        <div class="relative flex items-center justify-between">
                            <div class="flex-1">
                                <h3 class="text-xl font-bold text-white mb-1 group-hover:text-primary transition-colors duration-300">
                                    Contacto
                                </h3>
                                <p class="text-sm text-gray-500 group-hover:text-gray-400 transition-colors duration-300">
                                    Habla con nuestro equipo
                                </p>
                            </div>
                            
                            <div class="flex items-center justify-center w-10 h-10 rounded-xl bg-primary/10 group-hover:bg-primary/20 transition-all duration-300 group-hover:scale-110">
                                <svg class="w-5 h-5 text-primary group-hover:translate-x-0.5 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7" />
                                </svg>
                            </div>
                        </div>
                    </div>
                </a>
            </div>

            <ButtonWppHeader />

            <div class="mobile-link opacity-0 translate-y-8 mt-2" style="transition-delay: 400ms;">
                <div class="relative overflow-hidden rounded-2xl border border-primary/20 bg-gradient-to-br from-primary/[0.08] via-primary/[0.03] to-transparent backdrop-blur-xl p-6 shadow-lg">
                    <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_120%,rgba(1,219,176,0.1),transparent_50%)]"></div>
                    
                    <div class="relative">
                        <div class="flex items-center gap-2 mb-3">
                            <div class="flex gap-1">
                                <div class="w-1.5 h-1.5 rounded-full bg-primary animate-pulse"></div>
                                <div class="w-1.5 h-1.5 rounded-full bg-primary/60 animate-pulse" style="animation-delay: 0.2s;"></div>
                                <div class="w-1.5 h-1.5 rounded-full bg-primary/40 animate-pulse" style="animation-delay: 0.4s;"></div>
                            </div>
                            <span class="text-xs font-bold text-primary/80 uppercase tracking-widest">Plazas Limitadas</span>
                        </div>
                        
                        <div class="flex items-baseline gap-2 mb-1">
                            <span class="text-5xl font-black bg-gradient-to-br from-primary via-primary to-[#00ffc6] bg-clip-text text-transparent leading-none">5</span>
                            <span class="text-lg font-semibold text-gray-400">Spots disponibles</span>
                        </div>
                        
                        <div class="flex items-center gap-2 mt-3 pt-3 border-t border-white/10">
                            <svg class="w-4 h-4 text-primary/60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="text-sm font-medium text-gray-400">Enero 2026</span>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</div>

<script>
    const menuBtn = document.getElementById('mobile-menu-btn') as HTMLButtonElement;
    const mobileMenu = document.getElementById('mobile-menu') as HTMLDivElement;
    const mobileMenuClose = document.getElementById('mobile-menu-close') as HTMLButtonElement;
    const header = document.getElementById('main-header') as HTMLElement;
    const mobileLinks = document.querySelectorAll('.mobile-link') as NodeListOf<HTMLElement>;
    let isMenuOpen = false;

    function toggleMenu() {
        isMenuOpen = !isMenuOpen;
        
        if (isMenuOpen) {
            mobileMenu.classList.remove('translate-x-full');
            menuBtn.setAttribute('aria-expanded', 'true');
            menuBtn.setAttribute('aria-label', 'Cerrar menú');
            document.body.style.overflow = 'hidden';
            
            const lines = menuBtn.querySelectorAll('.hamburger-line') as NodeListOf<HTMLElement>;
            lines[0].style.transform = 'rotate(45deg) translateY(11px)';
            lines[1].style.opacity = '0';
            lines[2].style.transform = 'rotate(-45deg) translateY(-11px)';
            
            setTimeout(() => {
                mobileLinks.forEach((link, i) => {
                    setTimeout(() => {
                        link.style.opacity = '1';
                        link.style.transform = 'translateY(0)';
                    }, i * 80);
                });
            }, 100);
            
        } else {
            mobileMenu.classList.add('translate-x-full');
            menuBtn.setAttribute('aria-expanded', 'false');
            menuBtn.setAttribute('aria-label', 'Abrir menú');
            document.body.style.overflow = '';
            
            const lines = menuBtn.querySelectorAll('.hamburger-line') as NodeListOf<HTMLElement>;
            lines[0].style.transform = '';
            lines[1].style.opacity = '';
            lines[2].style.transform = '';
            
            mobileLinks.forEach(link => {
                link.style.opacity = '0';
                link.style.transform = 'translateY(2rem)';
            });
        }
    }

    menuBtn?.addEventListener('click', toggleMenu);
    mobileMenuClose?.addEventListener('click', toggleMenu);

    mobileLinks.forEach(link => {
        const anchor = link.tagName === 'A' ? link : link.querySelector('a');
        anchor?.addEventListener('click', () => {
            if (isMenuOpen) setTimeout(() => toggleMenu(), 200);
        });
    });

    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && isMenuOpen) toggleMenu();
    });

    // Header scroll optimizado con requestAnimationFrame
    let lastScroll = 0;
    let ticking = false;

    window.addEventListener('scroll', () => {
        if (!ticking) {
            window.requestAnimationFrame(() => {
                const currentScroll = window.pageYOffset;
                
                if (currentScroll > 100) {
                    header?.classList.add('shadow-on');
                } else {
                    header?.classList.remove('shadow-on');
                }
                
                lastScroll = currentScroll;
                ticking = false;
            });
            
            ticking = true;
        }
    }, { passive: true });
</script>

<style >
    :global(body) {
        padding-top: 80px;
    }

    @media (max-width: 1023px) {
        :global(body) {
            padding-top: 72px;
        }
    }
    
    .shadow-on {
        padding-block: 10px;
        box-shadow: 0 10px 40px rgba(1, 219, 176, 0.12);
    }
    
    .shadow-on::before {
        content: '';
        position: absolute;
        inset: 0;
        background: rgba(10, 10, 10, 0.98);
        z-index: -1;
    }

    .mobile-link {
        transition: opacity 0.7s cubic-bezier(0.16, 1, 0.3, 1),
                    transform 0.7s cubic-bezier(0.16, 1, 0.3, 1);
    }


    #mobile-menu {
        will-change: transform;
        -webkit-overflow-scrolling: touch;
        contain: layout style paint;
    }

    .mobile-link {
        will-change: opacity, transform;
        contain: layout style paint;
    }

    /* Hardware acceleration */
    #main-header,
    .mobile-link,
    .group {
        transform: translateZ(0);
        backface-visibility: hidden;
        perspective: 1000px;
    }
</style>