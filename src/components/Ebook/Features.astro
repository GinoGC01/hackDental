---
// src/components/Features.astro
import Candado from '../../Icons/Candado.astro';
import Heart from '../../Icons/Ebook/Heart.astro';
import Calendar from '../../Icons/Ebook/Calendar.astro';
import DollarSign from '../../Icons/Ebook/Dollar.astro';
import Frown from '../../Icons/Ebook/Frown.astro';
import Smile from '../../Icons/Ebook/Smile.astro';
import Button from './Button.astro';

const beforeSlides = [
  {
    image: "../../../public/iamges/imagen x derecha.svg",
    title: "Posteos Gen√©ricos",
    desc: "Fotos de stock aburridas que nadie comenta. 'Ofrecemos calidad y servicio'.",
    icon: "frown",
    stats: "0 likes ‚Ä¢ 0 citas"
  },
  {
    image: "../../../public/iamges/imagen x derecha.svg",
    title: "Sillones Vac√≠os",
    desc: "Huecos en la agenda y personal parado mirando el m√≥vil.",
    icon: "calendar",
    stats: "Perdiendo dinero/hora"
  },
  {
    image: "../../../public/iamges/imagen x derecha.svg",
    title: "Estr√©s Constante",
    desc: "Preocupado por pagar las n√≥minas y compitiendo por precio.",
    icon: "dollar",
    stats: "Burnout total"
  }
];

const afterSlides = [
  {
    image: "../../../public/iamges/imagen 2.svg",
    title: "",
    desc: "",
    icon: "heart",
    stats: "+124 Pacientes interesados"
  },
  {
    image: "../../../public/iamges/imagen 2.svg",
    title: "",
    desc: "",
    icon: "calendar-green",
    stats: "Rentabilidad M√°xima"
  },
  {
    image: "../../../public/iamges/imagen-1.svg",
    title: "",
    desc: "",
    icon: "smile",
    stats: "Vida de Due√±o"
  }
];

---

<section class="py-12 md:py-24 bg-white relative overflow-hidden">
  <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/graphy.png')] opacity-5 pointer-events-none"></div>

  <div class="max-w-7xl mx-auto px-4 relative z-10">
    
    <div class="text-center mb-10 md:mb-16 max-w-4xl mx-auto">
      <div class="inline-block bg-brand-red/10 text-brand-red px-3 py-1 rounded-full text-[10px] md:text-xs font-bold uppercase tracking-widest mb-3 border border-brand-red/20">
        üìñ Transformaci√≥n Real
      </div>
      <h2 class="text-3xl md:text-5xl font-black font-heading text-gray-900 uppercase leading-[0.9] mb-3">
        He transformado completamente <br/>
        <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-red-400 italic pr-2">mi cl√≠nica dental.</span>
      </h2>
      <p class="text-sm md:text-lg text-gray-600 font-medium max-w-2xl mx-auto mt-4">
         De perseguir pacientes regateadores a tener lista de espera para tratamientos de alto valor. <br/>
         <span class="text-brand-red font-bold">No fue suerte... t√∫ tambi√©n puedes hacerlo.</span>
      </p>
    </div>

    <div class="bg-gray-100 rounded-2xl md:rounded-[2rem] p-4 md:p-12 mb-16 border border-gray-200 shadow-inner relative overflow-hidden">
       
       <div class="flex md:hidden justify-between mb-4 gap-2">
          <span class="bg-gray-200 text-gray-600 text-[10px] font-bold px-2 py-1 rounded-full border border-gray-300">
             Haciendo esto üò≠
          </span>
          <span class="bg-green-100 text-green-700 text-[10px] font-bold px-2 py-1 rounded-full border border-green-200">
             A esto üöÄ
          </span>
       </div>

       <div class="grid md:grid-cols-12 gap-6 items-center">
          
          <div class="md:col-span-5 relative group">
              <div class="hidden md:flex absolute -top-6 left-4 z-20 bg-gray-200 text-gray-600 text-xs font-bold px-4 py-2 rounded-full border border-gray-300 shadow-sm items-center gap-2 transform -rotate-2 group-hover:rotate-0 transition-transform">
                 Literalmente hac√≠a esto üò≠
              </div>

              <div class="bg-white rounded-xl shadow-md border border-gray-200 overflow-hidden relative h-[320px] md:h-[380px] flex flex-col carousel-before">
                 {beforeSlides.map((slide, index) => (
                   <div 
                     class={`carousel-slide absolute inset-0 transition-opacity duration-700 ease-in-out flex flex-col ${index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
                     data-slide={index}
                   >
                     <div class="p-3 flex items-center gap-2 border-b border-gray-100 bg-white shrink-0">
                        <div class="w-8 h-8 bg-blue-50 rounded-full flex items-center justify-center grayscale opacity-50">ü¶∑</div>
                        <div class="flex-1">
                           <div class="h-2 w-24 bg-gray-100 rounded mb-1"></div>
                           <div class="h-1.5 w-12 bg-gray-50 rounded"></div>
                        </div>
                     </div>

                     <div class="flex-1 relative overflow-hidden bg-gray-100 group-hover:grayscale-0 transition-all duration-500 grayscale-[30%]">
                        <img src={slide.image} alt={slide.title} class="block w-full h-full object-cover opacity-90" />
                     </div>

                     <div class="pt-2 pb-[20px] w-[95%] m-auto border-t border-gray-100 bg-gray-50 flex justify-between items-center text-xs text-gray-400 shrink-0">
                        <div class="flex items-center gap-2">
                          {slide.icon === 'frown' && <Frown color="#d92027" />}
                          {slide.icon === 'calendar' && <Calendar color="#787878" />}
                          {slide.icon === 'dollar' && <DollarSign color="#d92027" />}
                          {slide.stats}
                        </div>
                     </div>
                   </div>
                 ))}
                 
                 <div class="absolute bottom-[4px] left-[50%] w-[95%] -translate-x-[50%] flex p-1 gap-1 z-20">
                    {beforeSlides.map((_, idx) => (
                       <div class={`carousel-indicator h-1 rounded-full flex-1 transition-all duration-300 ${idx === 0 ? 'bg-red-500' : 'bg-gray-200'}`} data-index={idx} />
                    ))}
                 </div>
              </div>
          </div>

          <div class="md:col-span-2 text-center py-4 md:py-0">
             <h3 class="text-2xl md:text-4xl font-black font-heading text-gray-400 uppercase tracking-widest animate-pulse">
                HACIA...
             </h3>
          </div>

          <div class="md:col-span-5 relative group ">
              <div class="hidden md:flex absolute -top-6 right-4 z-20 bg-brand-red text-white text-xs font-bold px-4 py-2 rounded-full border border-red-700 shadow-lg items-center gap-2 transform rotate-2 group-hover:rotate-0 transition-transform">
                 A esto üíã
              </div>

              <div class="bg-white rounded-xl shadow-2xl border border-[#D92027]/60 overflow-hidden relative h-[320px] md:h-[380px] flex flex-col ring-4 ring-[#D92027]/20 transform scale-105 hover:scale-[1.07] transition-all duration-500 z-10 carousel-after">
                 {afterSlides.map((slide, index) => (
                   <div 
                     class={`carousel-slide absolute inset-0 transition-opacity duration-700 ease-in-out flex flex-col ${index === 0 ? 'opacity-100 z-10' : 'opacity-0 z-0'}`}
                     data-slide={index}
                   >
                     <div class="p-3 flex items-center gap-2 border-b border-gray-100 bg-white shrink-0">
                        <div class="w-8 h-8 bg-brand-red text-white rounded-full flex items-center justify-center font-bold text-xs">HD</div>
                        <div class="flex-1">
                           <div class="font-bold text-xs text-gray-900">Tu Cl√≠nica Top 1%</div>
                           <div class="text-[10px] text-gray-500 flex items-center gap-1">Publicidad <span class="w-1 h-1 bg-gray-400 rounded-full"></span> üåç</div>
                        </div>
                        <div class="bg-green-100 text-green-700 px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider">√âxito</div>
                     </div>

                     <div class="flex-1 relative overflow-hidden bg-gray-900">
                        <img src={slide.image} alt={slide.title} class="absolute inset-0 w-full h-full object-cover" />
                        <div class="absolute inset-0 bg-gradient-to-t from-[#D92027]/90 via-transparent to-transparent flex flex-col justify-end p-4">
                            <h4 class="text-white font-heading font-bold text-xl uppercase leading-none mb-1">{slide.title}</h4>
                            <p class="text-white/90 text-xs font-medium">{slide.desc}</p>
                        </div>
                     </div>

                     <div class="pt-2 pb-[20px] border-t border-gray-100 bg-white flex justify-between items-center text-xs shrink-0 w-[95%] m-auto">
                        <div class="flex items-center gap-2 font-bold text-gray-800">
                           {slide.icon === 'heart' && <Heart color="#d92027" />}
                           {slide.icon === 'calendar-green' && <Calendar color="#169946" />}
                           {slide.icon === 'smile' && <Smile color="#169946" />}
                           <span>{slide.icon === 'heart' ? <span> {slide.stats} <span class="text-[#169946]">‚¨Ü</span></span> : slide.stats}</span>
                        </div>
                        <div class="bg-brand-red text-white text-[10px] px-2 py-1 rounded font-bold uppercase">Ver Estrategia</div>
                     </div>
                   </div>
                 ))}

                 <div class="absolute bottom-[4px] left-[50%] w-[95%] -translate-x-[50%] flex p-1 gap-1 z-20">
                    {afterSlides.map((_, idx) => (
                       <div class={`carousel-indicator h-1 rounded-full flex-1 transition-all duration-300 ${idx === 0 ? 'bg-brand-red' : 'bg-gray-200'}`} data-index={idx} />
                    ))}
                 </div>
              </div>
          </div>

       </div>
    </div>

    <div class="mt-12 text-center">
        <div class="inline-block relative group">
            <div class="absolute -inset-1 bg-gradient-to-r from-brand-red to-orange-600 rounded-lg blur opacity-30 group-hover:opacity-60 transition duration-200"></div>
            <Button className="px-12 py-4 text-xl">
               QUIERO ESTA TRANSFORMACI√ìN GRATIS
            </Button>
        </div>
        <p class="mt-4 text-xs text-gray-400 uppercase tracking-widest block flex items-center justify-center">
           <Candado size="18" color="#949aa5" className="-translate-y-[1px]" /> Estrategia probada en +500 cl√≠nicas
        </p>
    </div>

  </div>
</section>

<script>
  let currentSlide = 0;
  const slideCount = 3;

  function updateCarousels() {
    const beforeSlides = document.querySelectorAll('.carousel-before .carousel-slide');
    const afterSlides = document.querySelectorAll('.carousel-after .carousel-slide');
    const beforeIndicators = document.querySelectorAll('.carousel-before .carousel-indicator');
    const afterIndicators = document.querySelectorAll('.carousel-after .carousel-indicator');

    beforeSlides.forEach((slide, idx) => {
      if (idx === currentSlide) {
        slide.classList.remove('opacity-0', 'z-0');
        slide.classList.add('opacity-100', 'z-10');
      } else {
        slide.classList.remove('opacity-100', 'z-10');
        slide.classList.add('opacity-0', 'z-0');
      }
    });

    afterSlides.forEach((slide, idx) => {
      if (idx === currentSlide) {
        slide.classList.remove('opacity-0', 'z-0');
        slide.classList.add('opacity-100', 'z-10');
      } else {
        slide.classList.remove('opacity-100', 'z-10');
        slide.classList.add('opacity-0', 'z-0');
      }
    });

    beforeIndicators.forEach((indicator, idx) => {
      if (idx === currentSlide) {
        indicator.classList.remove('bg-gray-200');
        indicator.classList.add('bg-red-500');
      } else {
        indicator.classList.remove('bg-red-500');
        indicator.classList.add('bg-gray-200');
      }
    });

    afterIndicators.forEach((indicator, idx) => {
      if (idx === currentSlide) {
        indicator.classList.remove('bg-gray-200');
        indicator.classList.add('bg-brand-red');
      } else {
        indicator.classList.remove('bg-brand-red');
        indicator.classList.add('bg-gray-200');
      }
    });

    currentSlide = (currentSlide + 1) % slideCount;
  }

  setInterval(updateCarousels, 3500);
</script>