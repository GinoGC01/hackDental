---
import ChevronLeft from "../../Icons/Ebook/ChevronLeft.astro";
import ChevronRight from "../../Icons/Ebook/ChevronRight.astro";
import Target from "../../Icons/Ebook/Target.astro";
import ShieldAlert from "../../Icons/Ebook/ShieldAlert.astro";
import Check from "../../Icons/Ebook/Check.astro";


const pages = [
  {
    id: 1,
    title: "El 'Funnel' Anti-Curiosos",
    subtitle: "P√°gina 12",
    description: "El diagrama exacto para filtrar a los que solo buscan precio.",
  },
  {
    id: 2,
    title: "Scripts de WhatsApp",
    subtitle: "P√°gina 24",
    description: "Copia y pega estas respuestas para cerrar citas en fr√≠o.",
  },
  {
    id: 3,
    title: "Anatom√≠a del Anuncio",
    subtitle: "P√°gina 08",
    description: "Por qu√© tus fotos de stock est√°n tirando dinero a la basura.",
  },
  {
    id: 4,
    title: "Oferta Irresistible",
    subtitle: "P√°gina 18",
    description: "C√≥mo estructurar precios sin parecer 'low cost'.",
  }
];
---

<section class="py-16 md:py-24 relative overflow-hidden">
  <div class="absolute inset-0 bg-[#0a0a0a] z-0"></div>
  <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/dark-matter.png')] opacity-30 z-0"></div>

  <div class="max-w-6xl mx-auto px-4 relative z-10">
    
    <div class="text-center mb-12 md:mb-16">
      <h2 class="text-3xl md:text-5xl font-bold font-heading text-white mb-4 uppercase tracking-tight">
        Lo que encontrar√°s <span class="text-transparent bg-clip-text bg-gradient-to-r from-red-500 to-pink-500">dentro</span> üìñ
      </h2>
      <p class="text-gray-400 text-sm md:text-base max-w-xl mx-auto">
        Sin relleno. Sin teor√≠a aburrida. Solo t√°cticas probadas para copiar y pegar en tu cl√≠nica ma√±ana mismo.
      </p>
    </div>

    <div class="relative flex items-center justify-center">
      
      <button 
        id="prev-slide"
        class="absolute -left-1 md:left-12 z-20 w-10 h-10 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center shadow-[0_0_20px_rgba(217,32,39,0.5)] hover:scale-110 active:scale-95 transition-all text-white border-2 border-white/20"
        aria-label="Previous slide"
      >
        <ChevronLeft />
      </button>

      <button 
        id="next-slide"
        class="absolute -right-1 md:right-12 z-20 w-10 h-10 md:w-14 md:h-14 rounded-full bg-gradient-to-br from-red-500 to-pink-600 flex items-center justify-center shadow-[0_0_20px_rgba(217,32,39,0.5)] hover:scale-110 active:scale-95 transition-all text-white border-2 border-white/20"
        aria-label="Next slide"
      >
        <ChevronRight />
      </button>

      <div class="relative w-full max-w-[280px] md:max-w-4xl h-[400px] md:h-[450px] flex items-center justify-center perspective-1000" id="carousel-container">
         
         {pages.map((page, index) => {
           let positionClass = '';
           if (index === 0) {
             positionClass = 'z-20 scale-100 opacity-100 translate-x-0';
           } else if (index === 3) {
             positionClass = 'z-10 scale-[0.85] opacity-40 -translate-x-[60%] md:-translate-x-[350px] blur-[2px]';
           } else if (index === 1) {
             positionClass = 'z-10 scale-[0.85] opacity-40 translate-x-[60%] md:translate-x-[350px] blur-[2px]';
           } else {
             positionClass = 'hidden';
           }

           return (
             <div
                class={`ebook-card absolute transition-all duration-500 ease-out w-[280px] md:w-[320px] aspect-[3/4] ${positionClass}`}
                data-index={index}
             >
                <div class="w-full h-full bg-white rounded-lg shadow-2xl relative overflow-hidden group">
                    
                    <div class="h-4 bg-gray-100 border-b border-gray-200 flex items-center px-4 gap-4">
                       <div class="w-2 h-2 rounded-full bg-gray-300 shadow-inner"></div>
                       <div class="w-2 h-2 rounded-full bg-gray-300 shadow-inner"></div>
                       <div class="w-2 h-2 rounded-full bg-gray-300 shadow-inner"></div>
                    </div>

                    <div class="p-6 md:p-8 flex flex-col h-[calc(100%-16px)]">
                       <div class="flex justify-between items-start mb-4 border-b border-gray-100 pb-2">
                          <div>
                             <p class="text-[10px] text-brand-red font-bold uppercase tracking-widest">{page.subtitle}</p>
                             <h3 class="text-xl font-heading font-bold text-gray-900 leading-none">{page.title}</h3>
                          </div>
                          <Target className="w-5 h-5 text-gray-300" />
                       </div>
                       
                       <div class="flex-1 bg-gray-50 border border-gray-100 border-dashed rounded-lg p-2 relative">
                           {index === 0 && (
                             <div class="flex flex-col h-full justify-center items-center space-y-4">
                               <h4 class="text-gray-900 font-bold uppercase tracking-widest text-xs mb-2">Diagrama de Flujo</h4>
                               <div class="w-full max-w-[200px] space-y-2">
                                  <div class="bg-gray-100 p-2 rounded text-center text-xs border border-gray-300">Anuncio FB/IG</div>
                                  <div class="h-4 w-0.5 bg-gray-300 mx-auto"></div>
                                  <div class="bg-red-50 p-2 rounded text-center text-xs border border-red-200 font-bold text-red-600">Filtro Autom√°tico</div>
                                  <div class="h-4 w-0.5 bg-gray-300 mx-auto"></div>
                                  <div class="flex gap-2 justify-center">
                                     <div class="bg-green-50 p-2 rounded text-center text-[10px] border border-green-200 w-1/2">Cita Pagada</div>
                                     <div class="bg-gray-50 p-2 rounded text-center text-[10px] border border-gray-200 w-1/2 text-gray-400">Curioso (Fuera)</div>
                                  </div>
                               </div>
                             </div>
                           )}
                           {index === 1 && (
                             <div class="flex flex-col h-full justify-center px-2 space-y-3">
                               <div class="flex items-end gap-2">
                                  <div class="w-6 h-6 rounded-full bg-gray-200 shrink-0"></div>
                                  <div class="bg-gray-100 p-2 rounded-2xl rounded-bl-none text-[10px] text-gray-600 max-w-[80%]">
                                    Hola, ¬øcu√°nto cuesta el implante?
                                  </div>
                               </div>
                               <div class="flex items-end gap-2 flex-row-reverse">
                                  <div class="w-6 h-6 rounded-full bg-green-600 shrink-0 flex items-center justify-center text-white text-[8px]">Dr</div>
                                  <div class="bg-green-100 p-2 rounded-2xl rounded-br-none text-[10px] text-green-900 max-w-[90%] shadow-sm">
                                    Hola! üëã Para darte un precio exacto necesitamos ver tu caso. ¬øTe viene mejor <b>ma√±ana a las 10:00</b> o <b>el jueves por la tarde</b>?
                                  </div>
                               </div>
                               <div class="text-center">
                                  <span class="bg-yellow-100 text-yellow-700 text-[9px] px-2 py-0.5 rounded-full font-bold">Respuesta Psicol√≥gica Clave</span>
                               </div>
                             </div>
                           )}
                           {index === 2 && (
                             <div class="flex flex-col h-full justify-center items-center">
                                <div class="grid grid-cols-2 gap-3 w-full">
                                   <div class="relative opacity-50 grayscale">
                                      <div class="aspect-square bg-gray-200 rounded flex items-center justify-center mb-1">
                                         <ShieldAlert className="w-6 h-6 text-gray-400" />
                                      </div>
                                      <div class="absolute inset-0 flex items-center justify-center">
                                         <div class="text-red-600 font-bold text-4xl">‚úï</div>
                                      </div>
                                      <p class="text-[9px] text-center">Foto Stock</p>
                                   </div>
                                   <div class="relative">
                                      <div class="aspect-square bg-red-50 border border-red-100 rounded flex items-center justify-center mb-1 shadow-sm">
                                         <div class="text-center">
                                           <span class="text-[10px] font-bold block">Caso Real</span>
                                           <span class="text-[8px] text-red-500">Antes/Despu√©s</span>
                                         </div>
                                      </div>
                                      <div class="absolute -top-2 -right-2 bg-green-500 text-white rounded-full p-0.5">
                                         <Check className="w-3 h-3" />
                                      </div>
                                      <p class="text-[9px] text-center font-bold">Alta Conversi√≥n</p>
                                   </div>
                                </div>
                             </div>
                           )}
                           {index === 3 && (
                             <div class="flex flex-col h-full justify-center px-4">
                                <div class="border border-gray-200 rounded-lg p-3 relative overflow-hidden">
                                   <div class="absolute top-0 right-0 bg-red-500 text-white text-[8px] px-2 py-0.5 font-bold">PACK PREMIUM</div>
                                   <h5 class="font-bold text-xs mb-1">Implante + Corona</h5>
                                   <ul class="text-[9px] space-y-1 text-gray-500 mb-2">
                                      <li>‚Ä¢ Estudio 3D <span class="text-green-600 font-bold">(Incluido)</span></li>
                                      <li>‚Ä¢ Limpieza previa <span class="text-green-600 font-bold">(Incluido)</span></li>
                                      <li>‚Ä¢ Garant√≠a de por vida</li>
                                   </ul>
                                   <div class="flex justify-between items-end">
                                      <span class="text-[10px] text-gray-400 line-through">1.200‚Ç¨</span>
                                      <span class="text-sm font-bold text-red-600">997‚Ç¨</span>
                                   </div>
                                </div>
                                <p class="text-[9px] text-center mt-2 text-gray-400 italic">Ejemplo de "Stacking" de valor</p>
                             </div>
                           )}
                       </div>

                       <div class="mt-4 text-xs text-gray-500 leading-tight font-medium">
                          {page.description}
                       </div>
                    </div>

                    <div class="absolute inset-0 bg-gradient-to-tr from-transparent via-white/5 to-white/20 pointer-events-none"></div>
                </div>
             </div>
           );
         })}

      </div>
    </div>

    <div class="flex justify-center gap-2 mt-8 md:mt-12" id="indicators">
       {pages.map((_, idx) => (
          <button 
            class={`ebook-indicator transition-all duration-300 rounded-full h-2 ${idx === 0 ? 'w-8 bg-brand-red' : 'w-2 bg-gray-700 hover:bg-gray-500'}`}
            data-index={idx}
          />
       ))}
    </div>

  </div>
</section>

<script>
  let currentIndex = 0;
  const totalPages = 4;

  function updateCarousel() {
    const cards = document.querySelectorAll('.ebook-card');
    const indicators = document.querySelectorAll('.ebook-indicator');

    cards.forEach((card, index) => {
      card.classList.remove(
        'z-20', 'scale-100', 'opacity-100', 'translate-x-0',
        'z-10', 'scale-[0.85]', 'opacity-40', 
        '-translate-x-[60%]', 'md:-translate-x-[350px]', 
        'translate-x-[60%]', 'md:translate-x-[350px]', 
        'blur-[2px]', 'hidden'
      );

      if (index === currentIndex) {
        card.classList.add('z-20', 'scale-100', 'opacity-100', 'translate-x-0');
      } else if (index === (currentIndex - 1 + totalPages) % totalPages) {
        card.classList.add('z-10', 'scale-[0.85]', 'opacity-40', '-translate-x-[60%]', 'md:-translate-x-[350px]', 'blur-[2px]');
      } else if (index === (currentIndex + 1) % totalPages) {
        card.classList.add('z-10', 'scale-[0.85]', 'opacity-40', 'translate-x-[60%]', 'md:translate-x-[350px]', 'blur-[2px]');
      } else {
        card.classList.add('hidden');
      }
    });

    indicators.forEach((indicator, index) => {
      if (index === currentIndex) {
        indicator.classList.remove('w-2', 'bg-gray-700');
        indicator.classList.add('w-8', 'bg-brand-red');
      } else {
        indicator.classList.remove('w-8', 'bg-brand-red');
        indicator.classList.add('w-2', 'bg-gray-700');
      }
    });
  }

  document.getElementById('prev-slide')?.addEventListener('click', () => {
    currentIndex = (currentIndex - 1 + totalPages) % totalPages;
    updateCarousel();
  });

  document.getElementById('next-slide')?.addEventListener('click', () => {
    currentIndex = (currentIndex + 1) % totalPages;
    updateCarousel();
  });

  document.querySelectorAll('.ebook-indicator').forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      currentIndex = index;
      updateCarousel();
    });
  });
</script>